*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;color:#222;background:#fff}
header{padding:12px 16px;border-bottom:1px solid #eee;display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
h1{font-size:18px;margin:0}
.tools{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.tools.row2{margin-top:6px}
.tools input,.tools select{padding:8px 10px}
.inline{display:inline-flex;gap:6px;align-items:center}
.tilde{padding:0 2px;color:#888}
button{padding:8px 12px;border:1px solid #ddd;background:#fafafa;border-radius:8px;cursor:pointer}
button:hover{background:#f2f2f2}
.view-toggle label{margin-left:6px}
.segmented input{padding:8px 10px;min-width:220px}
main{padding:16px}

/* テーブル（PC） */
.table-wrap{display:block}
table{width:100%;border-collapse:collapse}
th,td{padding:10px 8px;border-bottom:1px solid #eee;text-align:left;vertical-align:top}
th{position:sticky;top:0;background:#fff;z-index:1}
#pager{display:flex;gap:6px;justify-content:flex-end;padding-top:12px}
#pager button{padding:6px 10px}
.cell-contacts{display:flex;flex-direction:column;gap:4px;font-size:12px}
.cell-actions a{margin-right:8px;text-decoration:none}
.cell-actions a:hover{opacity:.8}

/* バッジ＆タグ */
.tags{display:flex;flex-wrap:wrap;gap:6px}
.tag{font-size:12px;border:1px solid #ddd;border-radius:999px;padding:2px 8px;background:#fafafa}
.badge{font-size:12px;border-radius:999px;padding:2px 8px;background:#eef;border:1px solid #ccd}
.badge.idle{background:#fee;border-color:#fcc}
.badge.loyal{background:#efe;border-color:#cfc}
.badge.new{background:#eef;border-color:#cce}
.badge.past{background:#eee;border-color:#ddd}
.badge.future{background:#e9f7ff;border-color:#bfe6ff}

/* カード（モバイル） */
.cards{display:none}
.cards .card{border:1px solid #eee;border-radius:12px;padding:12px;margin:10px 0;box-shadow:0 1px 3px rgba(0,0,0,.06)}
.cards .name{font-weight:600;margin-bottom:6px}
.cards .meta{font-size:12px;color:#666;margin-bottom:6px}
.cards .tags{margin-top:6px}

/* 右ドロワー（スクロール対応） */
#drawer{
  position: fixed; inset: 0; background: rgba(0,0,0,.3);
  display: none; overflow: hidden;
}
#drawer[aria-hidden="false"]{ display:block; }
.drawer-inner{
  position: absolute; right: 0; top: 0; bottom: 0;
  width: 560px; max-width: 100%;
  background: #fff; box-shadow: -8px 0 24px rgba(0,0,0,.15);
  padding: 16px 12px 24px; display: flex; flex-direction: column; gap: 12px;
  overflow-y: auto; -webkit-overflow-scrolling: touch; overscroll-behavior: contain; max-height: 100dvh;
}
.drawer-inner h2{margin:0 28px 0 8px;font-size:16px}
.drawer-inner .close{position:absolute;right:8px;top:8px}

/* クイックアクション */
.quick-actions{display:flex;flex-wrap:wrap;gap:8px;margin:0 8px}
.quick-actions a{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid #ddd;border-radius:999px;text-decoration:none;background:#fafafa;font-size:14px}
.quick-actions a:hover{background:#f5f5f5}

/* 予約流入元カウント（チップ） */
.srcstats{display:flex;flex-wrap:wrap;gap:8px;margin:0 8px 8px}
.srcchip{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border:1px solid #ddd;border-radius:999px;background:#f7f7f7;font-size:12px}
.srcchip .count{font-weight:600}

/* プロファイル編集フォーム */
.note-editor{border:1px solid #eee;border-radius:12px;padding:12px}
.note-editor .grid{display:grid;grid-template-columns:140px 1fr;gap:10px 12px;align-items:center}
.note-editor input,.note-editor select,.note-editor textarea{padding:8px 10px;border:1px solid #ddd;border-radius:8px}
.note-editor textarea{min-height:80px}
.note-editor .checks{display:flex;gap:12px;align-items:center}
.row.actions{display:flex;justify-content:flex-end;align-items:center;gap:12px;margin-top:8px}
.save-status{min-height:1.2em;font-size:12px;color:#666}
.last-indicator{font-size:12px;color:#555;margin-top:6px}

/* 履歴テーブル操作 */
#history .memo-text{white-space:pre-wrap}
.resched-editor{display:inline-flex;gap:6px;align-items:center}
.resched-editor[hidden]{display:none}

/* 重複候補パネル */
.dupes{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none}
.dupes[aria-hidden="false"]{display:block}
.dupes-inner{position:absolute;left:50%;top:8%;transform:translateX(-50%);width:960px;max-width:calc(100% - 24px);background:#fff;border-radius:12px;box-shadow:0 12px 32px rgba(0,0,0,.2);overflow:hidden}
.dupes .head{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid #eee}
.dupes .body{padding:12px 16px;max-height:70vh;overflow:auto}
.dupes .close{padding:6px 10px}

/* 表示切替（自動/モバイル/PC） */
@media (max-width: 900px){
  .note-editor .grid{grid-template-columns:1fr}
}
@media (max-width: 768px){
  body.view-auto .table-wrap{display:none}
  body.view-auto .cards{display:block}
}
body.view-mobile .table-wrap{display:none}
body.view-mobile .cards{display:block}
body.view-desktop .table-wrap{display:block}
body.view-desktop .cards{display:none}
