<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>顧客管理</title>
  <link rel="stylesheet" href="./manage.css" />
</head>
<body class="view-auto">
  <header>
    <h1>顧客管理</h1>
    <div class="tools">
      <input id="q" type="search" placeholder="名前・メール・電話で検索" />
      <input id="from" type="date" />
      <span class="tilde">〜</span>
      <input id="to" type="date" />
      <select id="menuFilter">
        <option value="">メニュー：すべて</option>
      </select>
      <input id="tagFilter" type="search" placeholder="タグで絞り込み（例：VIP）" />
      <select id="sort">
        <option value="lastReservation:desc">最終来店 新→旧</option>
        <option value="lastReservation:asc">最終来店 旧→新</option>
        <option value="totalReservations:desc">来店回数 多→少</option>
        <option value="name:asc">名前 A→Z</option>
      </select>
      <button id="reload">再読込</button>
      <button id="exportCsv">CSV</button>

      <div class="view-toggle" role="group" aria-label="表示切替">
        <label><input type="radio" name="view" value="auto" checked> 自動</label>
        <label><input type="radio" name="view" value="mobile"> モバイル</label>
        <label><input type="radio" name="view" value="desktop"> PC</label>
      </div>
    </div>
  </header>

  <main>
    <!-- PC向け：表 -->
    <section id="customersSection" class="table-wrap">
      <table id="customers">
        <thead>
          <tr>
            <th>お名前</th>
            <th>メール</th>
            <th>電話</th>
            <th>最終来店</th>
            <th>回数</th>
            <th>直近メニュー</th>
            <th>担当者</th>
            <th>タグ</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="pager"></div>
    </section>

    <!-- モバイル向け：カード -->
    <section id="cardsSection" class="cards" aria-hidden="true"></section>

    <!-- 右ドロワー：顧客プロファイル + 来店履歴 -->
    <section id="drawer" aria-hidden="true">
      <div class="drawer-inner">
        <button class="close" aria-label="閉じる">×</button>
        <h2 id="drawerTitle">顧客プロファイル & 来店履歴</h2>

        <div class="note-editor">
          <div class="grid">
            <label>氏名</label>           <input id="editName" type="text" />
            <label>氏名（カナ）</label>   <input id="editKana" type="text" />
            <label>性別</label>
            <select id="editGender">
              <option value="">未選択</option>
              <option>男性</option>
              <option>女性</option>
              <option>その他</option>
              <option>未回答</option>
            </select>
            <label>電話番号</label>       <input id="editPhone" type="tel" />
            <label>メールアドレス</label> <input id="editEmail" type="email" />
            <label>住所</label>           <input id="editAddress" type="text" />
            <label>生年月日</label>       <input id="editBirthdate" type="date" />
            <label>担当者</label>         <input id="editStaff" type="text" />

            <label>タグ</label>
            <input id="editTags" type="text" placeholder="カンマ区切り（例：VIP, 常連）" />
            <label>メモ</label>
            <textarea id="editMemo" rows="3" placeholder="任意メモ"></textarea>

            <label>初回予約日</label>     <input id="editFirst" type="text" readonly />
            <label>最終予約日</label>     <input id="editLast" type="text" readonly />
          </div>
          <div class="row actions">
            <button id="saveNote">保存</button>
            <span id="saveStatus" class="save-status" aria-live="polite"></span>
          </div>
        </div>

        <h3>来店履歴</h3>
        <table id="history">
          <thead>
            <tr><th>日時</th><th>メニュー</th><th>項目</th><th>ステータス</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- 予約メールの token 表示（任意） -->
    <section id="tokenView" style="display:none;">
      <h2>予約リンクからの表示</h2>
      <pre id="tokenResult"></pre>
    </section>
  </main>

  <script src="./manage.js"></script>
</body>
</html>
